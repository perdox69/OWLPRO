<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏ß‡∏´‡∏ô‡∏±‡∏á‡∏™‡∏∑‡∏≠ (‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤)</title>
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; margin: 0; padding: 20px; }
        .container { max-width: 700px; margin: 0 auto; background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        
        h1 { text-align: center; color: #2c3e50; margin-bottom: 5px; }
        .date-display { text-align: center; color: #7f8c8d; margin-bottom: 25px; font-size: 0.9em; }

        /* Role Switcher */
        .nav-buttons { display: flex; justify-content: center; gap: 10px; margin-bottom: 25px; background: #ecf0f1; padding: 5px; border-radius: 8px; width: fit-content; margin-left: auto; margin-right: auto; }
        .btn-role { padding: 8px 20px; border: none; cursor: pointer; border-radius: 6px; font-weight: bold; transition: 0.3s; background: transparent; color: #7f8c8d; }
        .btn-role.active { background-color: white; color: #2c3e50; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }

        .panel { display: none; animation: fadeIn 0.3s; }
        .panel.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Form Inputs */
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #34495e; }
        input, select { width: 100%; padding: 12px; border: 1px solid #bdc3c7; border-radius: 8px; box-sizing: border-box; font-size: 16px; }

        /* --- NEW: TIME SLOT GRID --- */
        .time-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 10px; }
        .time-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            background-color: white;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            font-size: 14px;
            transition: all 0.2s;
            color: #333;
        }
        .time-btn:hover:not(.booked):not(.selected) { border-color: #3498db; color: #3498db; }
        
        /* ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏∏‡πà‡∏° */
        .time-btn.selected { background-color: #3498db; color: white; border-color: #3498db; box-shadow: 0 4px 6px rgba(52, 152, 219, 0.3); }
        .time-btn.booked { background-color: #f1f1f1; color: #bbb; border-color: #eee; cursor: not-allowed; text-decoration: line-through; }

        /* Buttons & Tables */
        button.submit-btn { width: 100%; padding: 14px; background-color: #27ae60; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 16px; font-weight: bold; margin-top: 10px; }
        button.submit-btn:hover { background-color: #219150; }

        table { width: 100%; border-collapse: collapse; margin-top: 20px; font-size: 14px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: left; }
        th { background-color: #f8f9fa; color: #555; }
        .delete-btn { background-color: #e74c3c; color: white; border: none; padding: 6px 12px; border-radius: 4px; cursor: pointer; }

        .alert { padding: 12px; border-radius: 8px; margin-bottom: 15px; display: none; text-align: center; }
        .alert.success { background-color: #d4edda; color: #155724; }
        .alert.error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>

<div class="container">
    <h1>üèõÔ∏è ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏ß</h1>
    <p class="date-display"><span id="currentDate"></span></p>

    <div class="nav-buttons">
        <button id="tabUser" class="btn-role active" onclick="switchRole('user')">‡∏ô‡∏¥‡∏™‡∏¥‡∏ï (‡∏à‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á)</button>
        <button id="tabAdmin" class="btn-role" onclick="switchRole('admin')">‡πÄ‡∏à‡πâ‡∏≤‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡πà (Admin)</button>
    </div>

    <div id="userPanel" class="panel active">
        <div id="userAlert" class="alert"></div>

        <div class="form-group">
            <label>1. ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á / ‡∏£‡∏´‡∏±‡∏™‡∏ô‡∏¥‡∏™‡∏¥‡∏ï</label>
            <input type="text" id="studentName" placeholder="‡πÄ‡∏ä‡πà‡∏ô 66xxxxxxxx ‡∏™‡∏°‡∏ä‡∏≤‡∏¢">
        </div>

        <div class="form-group">
            <label>2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á</label>
            <select id="roomSelect" onchange="renderTimeSlots()">
                <option value="Room A">Room A (‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏ç‡πà)</option>
                <option value="Room B">Room B (‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏•‡πá‡∏Å)</option>
            </select>
        </div>

        <div class="form-group">
            <label>3. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤ (3 ‡∏ä‡∏°./‡∏£‡∏≠‡∏ö)</label>
            <p style="font-size: 12px; color: #666; margin-top: -5px;">*‡∏™‡∏µ‡πÄ‡∏ó‡∏≤ = ‡πÄ‡∏ï‡πá‡∏°, ‡∏™‡∏µ‡∏ü‡πâ‡∏≤ = ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ</p>
            <div id="timeGrid" class="time-grid">
                </div>
        </div>

        <button class="submit-btn" onclick="bookRoom()">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á</button>
    </div>

    <div id="adminPanel" class="panel">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</h2>
            <button onclick="resetSystem()" style="background:#333; color:white; border:none; padding:8px 12px; border-radius:4px; cursor:pointer;">‡∏•‡πâ‡∏≤‡∏á‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>
        <table id="adminTable">
            <thead>
                <tr>
                    <th>‡∏´‡πâ‡∏≠‡∏á</th>
                    <th>‡πÄ‡∏ß‡∏•‡∏≤</th>
                    <th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á</th>
                    <th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                </tr>
            </thead>
            <tbody id="adminTableBody"></tbody>
        </table>
    </div>
</div>

<script>
    // --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô ---
    const STORAGE_KEY = 'uni_booking_v2';
    // ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏£‡∏≠‡∏ö‡πÄ‡∏ß‡∏•‡∏≤‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡πÅ‡∏Å‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏•‡∏î‡πÑ‡∏î‡πâ)
    const TIME_SLOTS = [
        "09:00 - 12:00",
        "12:00 - 15:00",
        "15:00 - 18:00",
        "18:00 - 21:00"
    ];

    let bookings = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    let selectedTimeSlot = null; // ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡πÄ‡∏Å‡πá‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà user ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

    // ‡πÅ‡∏™‡∏î‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà
    document.getElementById('currentDate').textContent = new Date().toLocaleDateString('th-TH', { 
        weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' 
    });

    // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏ó‡∏≥‡∏á‡∏≤‡∏ô
    renderTimeSlots();

    // --- ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å ---

    // 1. ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤ (‡∏´‡∏±‡∏ß‡πÉ‡∏à‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç)
    function renderTimeSlots() {
        const room = document.getElementById('roomSelect').value;
        const grid = document.getElementById('timeGrid');
        grid.innerHTML = ''; // ‡∏•‡πâ‡∏≤‡∏á‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏Å‡πà‡∏≤‡∏Å‡πà‡∏≠‡∏ô‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà
        selectedTimeSlot = null; // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å

        TIME_SLOTS.forEach(slot => {
            // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡∏ô‡∏µ‡πâ ‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ ‡∏°‡∏µ‡∏Ñ‡∏ô‡∏à‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á?
            const isBooked = bookings.some(b => b.room === room && b.time === slot);
            
            const btn = document.createElement('div');
            btn.className = 'time-btn';
            btn.textContent = slot;

            if (isBooked) {
                // ‡∏ñ‡πâ‡∏≤‡∏à‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß
                btn.classList.add('booked');
                btn.innerHTML += ' <br><small>(‡πÄ‡∏ï‡πá‡∏°)</small>';
            } else {
                // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡∏ß‡πà‡∏≤‡∏á ‡πÉ‡∏´‡πâ‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏î‡πâ
                btn.onclick = () => selectTime(btn, slot);
            }

            grid.appendChild(btn);
        });
    }

    // 2. ‡πÄ‡∏°‡∏∑‡πà‡∏≠ User ‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏ß‡∏•‡∏≤
    function selectTime(btnElement, time) {
        // ‡πÄ‡∏≠‡∏≤‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏õ‡∏∏‡πà‡∏°‡∏≠‡∏∑‡πà‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Å‡πà‡∏≠‡∏ô
        document.querySelectorAll('.time-btn').forEach(b => b.classList.remove('selected'));
        
        // ‡πÉ‡∏™‡πà‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏î
        btnElement.classList.add('selected');
        
        // ‡∏à‡∏≥‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡∏•‡∏≤‡πÑ‡∏ß‡πâ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å
        selectedTimeSlot = time;
    }

    // 3. ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á
    function bookRoom() {
        const name = document.getElementById('studentName').value.trim();
        const room = document.getElementById('roomSelect').value;

        if (!name) {
            showAlert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏à‡∏≠‡∏á!", "error");
            return;
        }
        if (!selectedTimeSlot) {
            showAlert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£", "error");
            return;
        }

        // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏•‡∏á Array
        bookings.push({
            room: room,
            time: selectedTimeSlot,
            name: name,
            timestamp: new Date().toISOString()
        });

        // Save to LocalStorage
        localStorage.setItem(STORAGE_KEY, JSON.stringify(bookings));

        showAlert("‡∏à‡∏≠‡∏á‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!", "success");
        
        // Reset Form
        document.getElementById('studentName').value = '';
        renderTimeSlots(); // ‡∏£‡∏µ‡πÇ‡∏´‡∏•‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏´‡∏°‡πà (‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏á‡∏ï‡∏∞‡∏Å‡∏µ‡πâ‡∏à‡∏∞‡∏Å‡∏•‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏™‡∏µ‡πÄ‡∏ó‡∏≤)
    }

    // --- ‡∏™‡πà‡∏ß‡∏ô Admin & Helper ---

    function renderAdminTable() {
        const tbody = document.getElementById('adminTableBody');
        tbody.innerHTML = '';

        if (bookings.length === 0) {
            tbody.innerHTML = '<tr><td colspan="4" style="text-align:center; color:#999;">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ñ‡∏¥‡∏ß‡∏à‡∏≠‡∏á</td></tr>';
            return;
        }

        // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏≤‡∏°‡∏´‡πâ‡∏≠‡∏á -> ‡πÄ‡∏ß‡∏•‡∏≤
        bookings.sort((a,b) => a.room.localeCompare(b.room) || a.time.localeCompare(b.time));

        bookings.forEach((b, index) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td><b>${b.room}</b></td>
                <td>${b.time}</td>
                <td>${b.name}</td>
                <td><button class="delete-btn" onclick="cancelBooking(${index})">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button></td>
            `;
            tbody.appendChild(tr);
        });
    }

    function cancelBooking(index) {
        if(confirm("‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏à‡∏≠‡∏á‡∏ô‡∏µ‡πâ?")) {
            bookings.splice(index, 1);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(bookings));
            renderAdminTable();
            // ‡∏ñ‡πâ‡∏≤ User ‡πÄ‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á‡πÑ‡∏ß‡πâ ‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏ß‡∏•‡∏≤‡∏î‡πâ‡∏ß‡∏¢ (‡∏Å‡∏£‡∏ì‡∏µ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô tab ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
            renderTimeSlots(); 
        }
    }

    function switchRole(role) {
        document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.btn-role').forEach(b => b.classList.remove('active'));

        if(role === 'user') {
            document.getElementById('userPanel').classList.add('active');
            document.getElementById('tabUser').classList.add('active');
            renderTimeSlots();
        } else {
            document.getElementById('adminPanel').classList.add('active');
            document.getElementById('tabAdmin').classList.add('active');
            renderAdminTable();
        }
    }

    function showAlert(msg, type) {
        const el = document.getElementById('userAlert');
        el.textContent = msg;
        el.className = `alert ${type}`;
        el.style.display = 'block';
        setTimeout(() => el.style.display = 'none', 3000);
    }
    
    function resetSystem() {
        if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
            bookings = [];
            localStorage.removeItem(STORAGE_KEY);
            renderAdminTable();
        }
    }
</script>

</body>
</html>